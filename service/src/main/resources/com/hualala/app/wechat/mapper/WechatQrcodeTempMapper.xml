<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hualala.app.wechat.mapper.WechatQrcodeTempMapper">
	<insert id="insert" parameterType="com.hualala.app.wechat.model.WechatQrcodeTempModel">
		insert into tbl_shop_wechat_qrcode_temp (
			<if test="itemID !=null">itemID,</if>
			<if test="mpID !=null">mpID,</if>
			<if test="qrcodeType !=null">qrcodeType,</if>
			<if test="sceneID !=null">sceneID,</if>
			<if test="qrcodeName !=null">qrcodeName,</if>
			<if test="description !=null">description,</if>
			<if test="param1 !=null">param1,</if>
			<if test="param2 !=null">param2,</if>
			<if test="param3 !=null">param3,</if>
			<if test="locationName !=null">locationName,</if>
			<if test="shopID !=null">shopID,</if>
			<if test="ticket !=null">ticket,</if>
			<if test="wxUrl !=null">wxUrl,</if>
			<if test="deadTime !=null">deadTime,</if>
        action,createTime
		) values (
			<if test="itemID !=null">#{itemID},</if>
			<if test="mpID !=null">#{mpID},</if>
			<if test="qrcodeType !=null">#{qrcodeType},</if>
			<if test="sceneID !=null">#{sceneID},</if>
			<if test="qrcodeName !=null">#{qrcodeName},</if>
			<if test="description !=null">#{description},</if>
			<if test="param1 !=null">#{param1},</if>
			<if test="param2 !=null">#{param2},</if>
			<if test="param3 !=null">#{param3},</if>
			<if test="locationName !=null">#{locationName},</if>
			<if test="shopID !=null">#{shopID},</if>
			<if test="ticket !=null">#{ticket},</if>
			<if test="wxUrl !=null">#{wxUrl},</if>
			<if test="deadTime !=null">#{deadTime},</if>
        #{action}, #{createTime}
		)
	</insert>

	<select id="queryCount" resultType="java.lang.Integer" parameterType="java.util.Map">
    select count(1) from tbl_shop_wechat_qrcode_temp
    </select>
	<select id="queryList" resultType="com.hualala.app.wechat.model.WechatQrcodeTempModel" parameterType="java.util.Map">
    select
    <include refid="queryField"/>
    from tbl_shop_wechat_qrcode_temp
    limit #{offset}, #{pageSize}
    </select>
	<select id="queryMaxSenceID" resultType="java.lang.Integer" parameterType="java.lang.String">
    select IFNULL(max(sceneID),100000000) sceneID from tbl_shop_wechat_qrcode_temp
		where mpID=#{value} and action in(0,1);
    </select>
	<select id="queryCacheQrcode" resultType="com.hualala.app.wechat.model.WechatQrcodeTempModel" parameterType="java.util.Map">
		select
		<include refid="queryField"/>
		from (select <include refid="queryField"/> from tbl_shop_wechat_qrcode_temp where mpID=#{mpID})
		where qrcodeStatus = 1
		and qrcodeType > #{qrcodeType}
		and deadTime > #{deadTime}
		order by deadTime
		limit 0, #{size};
    </select>
	<update id="updateByPrimaryKey" parameterType="com.hualala.app.wechat.model.WechatQrcodeTempModel">
		select
		<include refid="queryField"/>
		from (select <include refid="queryField"/> from tbl_shop_wechat_qrcode_temp where mpID=#{mpID})
		where qrcodeStatus = 1
		and deadTime > #{deadTime}
		order by deadTime
		limit 0, #{size};
    </update>

    <sql id="queryField">
        itemID,mpID,qrcodeType,sceneID,qrcodeName,description,param1,param2,param3,
        locationName,shopID,ticket,wxUrl,qrcodeIP,isLog,deadTime,qrcodeStatus
    </sql>
</mapper>
